
<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>

		<style id="stylesheet">
			.box {
				position: absolute;
				top: 10px;
				left: 450px;
			}
		</style>
	</head>

	<body>

	    <a href="index.html">
          <button>âš½</button>
        </a>

        <a href="ball.html">
          <button>ğŸ€</button>
        </a>
        <a href="three.html">
          <button>ğŸ</button>
        </a>
		<div id="content">
			<div class="point">
				æ‹–åŠ¨å…¶ä¸­ä¸€ä¸ªçƒè¯•è¯•ï¼š
			</div>
			<canvas id="canvas" width="600" height="400" style="background:#333"></canvas>
		</div>

		<script src="scripts/tool.js?id=1"></script>
		<script id="scripts">
			var canvas = document.getElementById('canvas');
			var ctx = canvas.getContext('2d');
			var mouse = {
				x: 0,
				y: 0
			};
			var balles = []; //å­˜æ”¾é¡µé¢ä¸Šçš„çƒ
			var spring = 0.03;
			var friction = 0.95;
			var gravity = 2;
			var springLength = 100;
			var dx = 0;
			var dy = 0;
			// çƒå‡½æ•°
			function Ball(x, y, radius, speed) {
				this.x = x;
				this.y = y;
				this.radius = radius;
				this.angle = 0;
				this.vx = 0;
				this.vy = 0;
				this.speed = speed;
			};
			var ball0 = new Ball(Math.random() * canvas.width, Math.random() * canvas.height, 10);
			var ball1 = new Ball(Math.random() * canvas.width, Math.random() * canvas.height, 10);
			var ball2 = new Ball(Math.random() * canvas.width, Math.random() * canvas.height, 10);
			balles.push(ball0);
			balles.push(ball1);
			balles.push(ball2);
			var ball0_dragging = false;
			var ball1_dragging = false;
			var ball2_dragging = false;
			//ç»˜åˆ¶çƒ
			function animation() {
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				if(!ball0_dragging) {
					springTo(ball0, ball1);
					springTo(ball0,ball2);
				};
				if(!ball1_dragging) {
					springTo(ball1, ball0);
					springTo(ball1, ball2);
				};
				if(!ball2_dragging) {
					springTo(ball2, ball0);
					springTo(ball2, ball1);
				};
				ctx.beginPath();
				ctx.strokeStyle = '#fff';
				ctx.moveTo(ball0.x, ball0.y)
				ctx.lineTo(ball1.x, ball1.y);
				ctx.lineTo(ball2.x, ball2.y);
				ctx.lineTo(ball0.x, ball0.y);
				ctx.stroke();
				balles.forEach(function(ball,i){
					ctx.fillStyle = '#fff';
					ctx.beginPath();
					ctx.arc(ball.x, ball.y, ball.radius, 0, 2 * Math.PI, true);
					ctx.fill();
				});
				requestAnimationFrame(animation);
			};
			//è®©ballAå¼¹å‘ballB
			function springTo(ballA, ballB) {
				dx = ballA.x - ballB.x;
				dy = ballA.y - ballB.y;
				angle = Math.atan2(dy, dx); // è·å–é¼ æ ‡ä¸çƒä¹‹é—´çš„å¤¹è§’
				//è®¡ç®—ç›®æ ‡ç‚¹åæ ‡
				targetX = ballB.x + Math.cos(angle) * springLength;
				targetY = ballB.y + Math.sin(angle) * springLength;
				ballA.vx += (targetX - ballA.x) * spring;
				ballA.vy += (targetY - ballA.y) * spring;
				ballA.vx *= friction;
				ballA.vy *= friction;
				ballA.x += ballA.vx;
				ballA.y += ballA.vy;
			};
			//è·å–åœ†çš„è¾¹ç•ŒçŸ©å½¢
			function getBound(body){
				return  {
					x: (body.x - body.radius),
					y: (body.y - body.radius),
					width: body.radius * 2,
					height: body.radius * 2
				};
			}
			function mousedown(event) {
				mouse.x = event.point.x;
				mouse.y = event.point.y;
				//åˆ¤æ–­é¼ æ ‡æ˜¯å¦åœ¨ball0çƒä¸Š
				if(tool.containsPoint(getBound(ball0), mouse.x, mouse.y)) {
					ball0_dragging = true;
				};
				if(tool.containsPoint(getBound(ball1), mouse.x, mouse.y)) {
					ball1_dragging = true;
				};
				if(tool.containsPoint(getBound(ball2), mouse.x, mouse.y)) {
					ball2_dragging = true;
				};
			};

			function mousemove(event) {
				mouse.x = event.point.x;
				mouse.y = event.point.y;
				if(ball0_dragging) {
					ball0.x = mouse.x;
					ball0.y = mouse.y;
				};
				if(ball1_dragging) {
					ball1.x = mouse.x;
					ball1.y = mouse.y;
				};
				if(ball2_dragging) {
					ball2.x = mouse.x;
					ball2.y = mouse.y;
				};
			};

			function mouseup(event) {
				if(ball0_dragging || ball1_dragging || ball2_dragging) {
					ball0_dragging = false;
					ball1_dragging = false;
					ball2_dragging = false;
				}
			};
			window.onload = function() {

				mouse.x = canvas.width / 2;
				animation();
				tool.captureMT(canvas, mousedown, mousemove, mouseup);
			};
		</script>
	</body>

</html>